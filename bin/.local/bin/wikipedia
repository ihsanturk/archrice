#!/bin/sh

# Requirements:
# jq

#args
printDescription="false"

API="https://en.wikipedia.org/api/rest_v1"
CACHE_DIR="${XDG_CACHE_HOME:-"$HOME/.cache/wikipedia"}"

if [ $# -eq 0 ]; then
	read -p "Search: " TERM_
else
	for i in "$@"
	do
	case $i in
			-d|--description)
			printDescription="true";;
			*)
			i=$(echo $i | sed -e "s/\b\(.\)/\u\1/g")
			TERM_="${TERM_} $i"
			;;
	esac
	done
fi
TERM_=$(echo $TERM_ | sed 's/ /_/g')

CACHE="$CACHE_DIR/$TERM_"
[ ! -e "$CACHE_DIR" ] && mkdir -p "$CACHE_DIR"
[ ! -e "$CACHE" ] &&
	curl -s -L -X GET \
	"${API}/page/summary/$TERM_" -H"accept: application/json" > $CACHE

type_=$(cat "$CACHE" | jq -r '.type')
title=$(cat "$CACHE" | jq -r '.title')
description=$(cat "$CACHE" | jq -r '.description')
extract=$(cat "$CACHE" | jq -r '.extract')

tput dim; printf $type_ | fold -sw 80; tput sgr0; printf ' - ';
tput bold; tput setaf 2; printf $title | fold -sw 80; tput sgr0; printf " - "
tput setaf 3; printf $description | fold -sw 80; tput sgr0; echo
	

if [ "$printDescription" = "true" ]; then
	printf "${extract}\n" | fold -sw 80
fi
