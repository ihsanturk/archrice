#!/bin/sh
# changeBrightness
#
# brightness <relative value>
#
#
# Files should be writable by current user
# Change file permissions of br_path:
#
# sudo chmod 777 /sys/class/backlight/intel_backlight/brightness
#

# This script only runs if these files exist:
br_path="/sys/class/backlight/intel_backlight/brightness"
br_max_path="/sys/class/backlight/intel_backlight/max_brightness"
# ############################################

rate=$(bc -l <<< "$(cat $br_max_path) / 100")
current=$(bc -l <<< "scale=0; $(cat $br_path) / $rate")
value=$(($current + $1))

msgId="192837" # Arbitrary but unique message id
changed="false"

if [ $value -lt 1 ]; then
  value=1
elif [ $value -gt 100 ]; then
  printf $(cat $br_max_path) > $br_path && changed="true"
  value=100
else
  value=$(bc -l <<< "scale=1; ${value} * ${rate}" | cut -d. -f1)
  printf "${value}" > ${br_path} && changed="true"
  value=$(bc -l <<< "scale=1; ${value} / ${rate}" | cut -d. -f1)
fi

if [ $changed == "true" ]; then
  dunstify -u low -r "$msgId" \
  "Brightness: ${value}%" "$(getProgressString 33 "<b>â– </b>" " " $value)"
fi
