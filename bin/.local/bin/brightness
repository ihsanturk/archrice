#!/bin/sh
# changeBrightness
#
# brightness <relative value>
#
#
# Files should be writable by current user
# Change file permissions of br_path:
#
# sudo chmod 777 /sys/class/backlight/intel_backlight/brightness
#

# This script only runs if these files exist:
if [ -f "/sys/class/backlight/intel_backlight/brightness" ]; then
  br_path="/sys/class/backlight/intel_backlight/brightness"
else
  echo "Not found, file: /sys/class/backlight/intel_backlight/brightness"
  exit 2
fi

if [ -f "/sys/class/backlight/intel_backlight/max_brightness" ]; then
  br_max_path="/sys/class/backlight/intel_backlight/max_brightness"
else
  echo "Not found, file: /sys/class/backlight/intel_backlight/max_brightness"
  exit 2
fi

which bc > /dev/null || echo "Not found, package: bc" || exit 2 

# ############################################

rate=$(echo "$(cat $br_max_path)/100" | bc -l)
current=$(echo "scale=0; $(cat $br_path)/$rate" | bc -l)
value=$(($current + $1))


changed="false"

if [ $value -lt 1 ]; then
  value=1
elif [ $value -gt 100 ]; then
  printf $(cat $br_max_path) > $br_path && changed="true"
  value=100
else
  value=$(echo "scale=1; ${value}*${rate}" | bc -l | cut -d. -f1)
  printf "${value}" > ${br_path} && changed="true"
  value=$(echo "scale=1; ${value}/${rate}" | bc -l |  cut -d. -f1)
fi


msgId="192837" # Arbitrary but unique message id
if [ "$changed" = "true" ]; then
  # dunstify -u low -r "$msgId" \
  notify-send "$msgId" \
  "Brightness: ${value}%" "$(getProgressString 33 "<b>â– </b>" " " $value)" \
  > /dev/null || echo "Not found, package: dunstify"
fi
